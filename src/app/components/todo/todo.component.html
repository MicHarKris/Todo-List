<div class="todo-frame">
  <div *ngIf="(todos$ | async)?.length" class="todo">
    <ng-container [ngSwitch]="currentState">
      <!-- Todo List -->
      <!--  -->
      <!--  -->
      <div *ngSwitchCase="TodoState.LIST">
        <h2 class="title">List</h2>

        <!-- Header row -->
        <div class="todo-item">
          <div class="todo-cell">
            <p class="subtitle">Done</p>
          </div>

          <div class="todo-cell">
            <p class="subtitle">Id</p>
          </div>

          <div class="todo-cell">
            <p class="subtitle">Name</p>
          </div>

          <div class="todo-cell">
            <p class="subtitle">Created date</p>
          </div>
        </div>

        <!-- Iterate over todos array to display each todo item -->
        <div
          class="todo-item"
          *ngFor="let todo of todos$ | async"
          (click)="showDetail(todo.Id!)"
          style="cursor: pointer"
        >
          <!-- Display status icon -->
          <div class="todo-cell">
            <span
              class="status-icon"
              [ngClass]="{ 'status-icon-done': todo.Done }"
            >
              <i class="fa-solid fa-square-check" *ngIf="todo.Done"></i>
              <i class="fa-regular fa-square" *ngIf="!todo.Done"></i>
            </span>
          </div>

          <!-- Display todo ID -->
          <div class="todo-cell">
            <p>{{ todo.Id }}</p>
          </div>

          <!-- Display todo name -->
          <div class="todo-cell todo-name">
            <p>{{ todo.Name }}</p>
          </div>

          <!-- Display created date with conditional styling for invalid date -->
          <div class="todo-cell created-column">
            <p [ngClass]="{ 'invalid-date': !isValidDate(todo.Created) }">
              {{
                isValidDate(todo.Created)
                  ? (todo.Created | date: "MM/dd/yyyy")
                  : "Invalid date"
              }}
            </p>
          </div>
        </div>

        <!-- Button to navigate to create new todo page -->
        <button (click)="showNewForm()" class="new-todo-button">
          New Todo Item
        </button>
      </div>

      <!-- Todo Details -->
      <!--  -->
      <!--  -->
      <div *ngSwitchCase="TodoState.DETAIL" class="todo-new-item">
        <div class="todo-details">
          <ng-container *ngIf="todo$ | async as todo">
            <h2 class="title">Details</h2>

            <!-- Task name and status -->
            <div class="todo-task">
              <!-- Task name -->
              <p class="subtitle">
                {{ todo.Name }}
              </p>
              <!-- Task status -->
              <p
                class="todo-done"
                [ngClass]="{ 'is-done': todo.Done, 'not-done': !todo.Done }"
              >
                {{ todo.Done ? "Todo is done" : "Todo is NOT done" }}
              </p>
            </div>

            <!-- Description -->
            <p class="todo-desc">
              {{ todo.Description }}
            </p>

            <!-- Todo details -->
            <div class="todo-numbers">
              <!-- Todo ID -->
              <p>
                <strong>Id</strong>
                <span class="todo-id">{{ todo.Id }}</span>
              </p>
              <!-- Expenses -->
              <p>
                <strong>Expenses</strong>
                <span class="todo-expenses">{{
                  todo.Expenses | number: "1.2-2"
                }}</span>
              </p>
              <!-- Created date -->
              <p>
                <strong>Created date</strong>
                <span
                  class="todo-date"
                  [ngClass]="{ 'invalid-date': !isValidDate(todo.Created) }"
                >
                  {{
                    isValidDate(todo.Created)
                      ? (todo.Created | date: "MM/dd/yyyy")
                      : "Invalid date"
                  }}
                </span>
              </p>
              <!-- Days old -->
              <p>
                <strong>Days old</strong>
                <span
                  class="todo-age"
                  [ngClass]="{ 'invalid-date': !isValidDate(todo.Created) }"
                  >{{
                    isValidDate(todo.Created)
                      ? getDaysOld(todo.Created)
                      : "Age unknown"
                  }}</span
                >
              </p>
            </div>

            <!-- Add more details as needed -->
            <button (click)="showList()">Back to Todo List</button>
          </ng-container>
        </div>
      </div>

      <!-- Todo New -->
      <!--  -->
      <!--  -->
      <div *ngSwitchCase="TodoState.NEW">
        <h2 class="title">New Todo Item</h2>
        <!-- Todo Form -->
        <form
          [formGroup]="newTodoForm"
          (ngSubmit)="onSubmit()"
          class="todo-form"
        >
          <!-- Name Field -->
          <div class="todo-new-item">
            <label for="name" class="subtitle">Name:</label>
            <input
              id="name"
              type="text"
              formControlName="Name"
              required
              placeholder="Enter name..."
              class="todo-field"
            />

            <!-- Error message for required field -->
            <p
              class="todo-required"
              *ngIf="
                newTodoForm.get('Name')?.invalid &&
                (newTodoForm.get('Name')?.dirty ||
                  newTodoForm.get('Name')?.touched)
              "
            >
              Name is required.
            </p>
          </div>

          <!-- Description Field -->
          <div class="todo-new-item">
            <label for="description" class="subtitle">Description:</label>
            <textarea
              id="description"
              type="text"
              formControlName="Description"
              placeholder="Enter description..."
              class="todo-field"
            ></textarea>
          </div>

          <!-- Expenses Field -->
          <div class="todo-new-item">
            <label for="expenses" class="subtitle">Expenses:</label>
            <input
              id="expenses"
              type="text"
              formControlName="Expenses"
              placeholder="Enter expenses..."
              class="todo-field"
            />

            <!-- Error message for required field -->
            <p
              class="todo-required"
              *ngIf="
                newTodoForm.get('Expenses')?.invalid &&
                (newTodoForm.get('Expenses')?.dirty ||
                  newTodoForm.get('Expenses')?.touched)
              "
            >
              Expenses must be a number.
            </p>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            [disabled]="!newTodoForm.valid"
            [ngClass]="{
              'enabled-button': newTodoForm.valid,
              'disabled-button': !newTodoForm.valid
            }"
          >
            Submit
          </button>

          <!-- Back to list Button -->
          <button (click)="showList()">Back to list</button>
        </form>
      </div>
    </ng-container>
  </div>

  <!-- Display loading message if todo is not available -->
  <div *ngIf="!(todos$ | async)">
    <p>Loading TODO details...</p>
  </div>
</div>
